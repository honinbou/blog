<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="author" content="honinbou" />
<meta name="keywords" content="" />
<title>honinbou</title>
<link href="http://iguowei.net/feed.xml" rel="alternate" title="honinbou" type="application/atom+xml" />
<link rel="stylesheet" type="text/css" href="/assets/css/site.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/code/github.css" />

</head>

<body class="page-type-list">

<div class="main">
	<!-- 博客分类列表 -->
<!-- 首页即博客列表 -->


<header>
	<h1>honinbou</h1>
	<p class="additional">Some description of your site.</p>
</header>



<article content-loaded="1">
	<h2><a href="/posts/performance-test.html">性能测试和调优</a></h2>
	<p class="meta">
	<span class="datetime">2012-11-24</span> posted in [<a href="/category/thinking" class="category">闭门思考</a>]
</p>
	<div class="article-content">
	
		<p>性能测试和调优是一个比较复杂的问题，涉及到很多方面，这里总结一下之前做性能测试，查找系统瓶颈的经验。业界已经有人写了很多关于性能优化方法的文章，如：coolshell的博主陈皓的<a href="http://coolshell.cn/articles/7490.html">《性能调优攻略》</a></p>

<h1 id="section">系统性能的定义</h1>
<p>对系统性能的度量，是我们后续定位和优化的第一步，开展性能测试，一般都是先测试出单机单模块的性能，根据这个基础性能，对各个模块的配比有个基本的认识。在组合出最平衡的组合后，对其进行性能测试，线上也按照这个比例上线，基本可以确定整个集群的服务能力。</p>

<p>一般我们无法直接对整个集群的服务能力进行测试，比如线上1000台云存储服务的集群，可能没有条件对这1000台进行性能测试，因为你需要大量的client机器，当然这种计算可能会不太准，会有一定比例的折损，因为大的系统中可能涉及网络通讯，试错等逻辑，导致实际结果偏低。</p>

<p>系统性能的定义一般有三个指标：</p>

<ol>
  <li><strong>QPS</strong>(query per second) 每秒请求数，即服务器每秒能够服务的请求数目，单位：次/s；</li>
  <li><strong>Latency</strong> 时延，即每次请求所花费的时间，单位：ms；</li>
  <li><strong>Throughput</strong> 吞吐量 即网路卡上的数据流量，单位：KB/s, MB/s, etc；</li>
</ol>

<p>三者之间有一定的制约关系：</p>

<ol>
  <li>一般QPS越高，latency会越长，Throughput会越大，因为系统会更繁忙，可能会存在额外的调度等待导致latency变长，Throughput也会响应增加；</li>
  <li>Latency越低，代表请求很快就结束了，这样单位时间内能够容纳的请求就越多，QPS就可以越高；</li>
  <li>Throughput一般只要不是到达网卡瓶颈，基本上都不会有影响，但是需要注意，在目前多核心的机器上，如果网卡的中断能够均匀分布到多个核心上，能提高不少机器的性能；</li>
</ol>

<p>系统的这个三个指标随着压力的增大，而没有提升，均是系统的某种资源达到瓶颈。下面介绍如何查看系统的稀缺资源</p>

<h1 id="section-1">系统资源介绍</h1>
<p>对于计算机系统，一般的瓶颈在于三个方面：CPU、内存、IO，IO又分磁盘IO和网卡IO，下面分别对这四个资源的度量进行介绍</p>

<h2 id="cpu">CPU</h2>
<p>CPU在linux系统中主要完成三个任务：</p>

<ol>
  <li>用户态进程的执行</li>
  <li>系统内核的执行</li>
  <li>idle状态</li>
</ol>

<h3 id="cpu-1">cpu的度量</h3>

<p>CPU的上述三个状态进一步细分可以分为：
* usr
* nice
* sys
* iowait
* irq
* soft
上面的状态公共mpstat命令可以很容易查看到</p>

<h3 id="cpu-2">cpu时间的计算</h3>

<h3 id="cpu-3">cpu状态的查看和相关命令</h3>

<h3 id="cpu-4">cpu的调优</h3>
<p>####改多线程为使用epool
####多核心cpu绑定特定进程到指定cpu</p>

<h2 id="section-2">内存</h2>
<p>内存完成的任务：</p>

<ol>
  <li>进程的执行空间</li>
  <li>进程内分配的空间</li>
  <li>缓存</li>
  <li>空闲</li>
</ol>

<h3 id="section-3">内存状态的查看和相关命令</h3>

<h3 id="malloc">malloc和延时分配</h3>

<h3 id="section-4">虚拟内存</h3>

<h2 id="io">磁盘IO</h2>

<h3 id="section-5">磁盘状态的查看和相关命令</h3>

<h3 id="cpu-5">磁盘，内存和CPU之间的影响</h3>

<h2 id="io-1">网卡IO</h2>
<p>###网卡的基本状态</p>

<h3 id="section-6">网卡的状态查看和相关工具</h3>

<h3 id="section-7">网卡的极限性能</h3>

<h1 id="section-8">常用的性能测试工具</h1>

<h2 id="http">HTTP：</h2>

<h3 id="ab">ab</h3>
<p>###siege
###curl-loader</p>

<h2 id="xmpp">XMPP</h2>
<p>###TSung</p>

<h1 id="section-9">如何分析定位分析系统的瓶颈</h1>
<ol>
  <li>
    <p>首先查看cpu，因为其最容易成为瓶颈</p>
  </li>
  <li>
    <p>查看网卡</p>
  </li>
  <li>
    <p>查看磁盘和内存</p>
  </li>
</ol>

<h1 id="demo">典型的瓶颈demo</h1>


	
	</div>
</article>

<article>
	<h2><a href="/posts/amazon-service-event.html">amazon 2012-10-22 事故分析总结</a></h2>
	<p class="meta">
	<span class="datetime">2012-11-22</span> posted in [<a href="/category/knowledge" class="category">知识经验</a>]
</p>
	<div class="article-content">
	
	</div>
</article>

<article>
	<h2><a href="/posts/lvs-test.html">lvs 测试</a></h2>
	<p class="meta">
	<span class="datetime">2012-11-21</span> posted in [<a href="/category/thinking" class="category">闭门思考</a>]
</p>
	<div class="article-content">
	
	</div>
</article>

<article>
	<h2><a href="/posts/pyinotify.html">pyinotify使用中的陷阱</a></h2>
	<p class="meta">
	<span class="datetime">2012-11-16</span> posted in [<a href="/category/thinking" class="category">闭门思考</a>]
</p>
	<div class="article-content">
	
	</div>
</article>

<article>
	<h2><a href="/posts/hello-world.html">你好，世界</a></h2>
	<p class="meta">
	<span class="datetime">2012-11-07</span> posted in [<a href="/category/" class="category"></a>]
</p>
	<div class="article-content">
	
	</div>
</article>






	<footer>
		<p>&copy; Since 2012</p>
	</footer>
</div>

<side>
	<h2><a href="/">honinbou</a><a href="/feed.xml" class="feed-link" title="Subscribe"><img src="http://blog.rexsong.com/wp-content/themes/rexsong/icon_feed.gif" alt="RSS feed" /></a></h2>
	
	<nav class="block">
		<ul>
		<li class="thinking"><a href="/category/thinking/">闭门思考</a></li>
		<li class="problems"><a href="/category/problems/">问题记录</a></li>
		<li class="knowledge"><a href="/category/knowledge/">知识经验</a></li>
		
		</ul>
	</nav>
	
	<form action="/search/" class="block block-search">
		<h3>Search</h3>
		<p><input type="search" name="q" placeholder="Search" /></p>
	</form>
	
	<div class="block block-about">
		<h3>About</h3>
		<figure>
			
			<figcaption><strong>honinbou</strong></figcaption>
		</figure>
		<p>Write something about yourself.</p>
	</div>
	
	<div class="block block-license">
		<h3>Copyright</h3>
		<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/cn/" target="_blank" class="hide-target-icon" title="Copyright declaration of site content"><img alt="知识共享许可协议" src="http://i.creativecommons.org/l/by-nc-nd/2.5/cn/88x31.png" /></a></p>
	</div>
	
	
	
	<div class="block block-thank">
		<h3>Powered by</h3>
		<p>
			<a href="http://disqus.com/" target="_blank">Disqus</a>,
			<a href="http://elfjs.com/" target="_blank">elf+js</a>,
			<a href="https://github.com/" target="_blank">GitHub</a>,
			<a href="http://www.google.com/cse/" target="_blank">Google Custom Search</a>,
			<a href="http://en.gravatar.com/" target="_blank">Gravatar</a>,
			<a href="http://softwaremaniacs.org/soft/highlight/en/">HighlightJS</a>,
			<a href="https://github.com/mojombo/jekyll" target="_blank">jekyll</a>,
			<a href="https://github.com/mytharcher/SimpleGray" target="_blank">SimpleGray</a>
		</p>
	</div>
</side>

<script src="http://elfjs.googlecode.com/files/elf-0.4.0-min.js"></script>
<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

<script src="/assets/js/site.js"></script>

<script>
site.URL_GOOGLE_API = 'http://www.google.com/jsapi';
site.URL_DISCUS_COMMENT = '' ? 'http://.disqus.com/embed.js' : '';

site.VAR_SITE_NAME = 'honinbou';
site.VAR_GOOGLE_CUSTOM_SEARCH_ID = '';
site.TPL_SEARCH_TITLE = '#{0} / 搜索：#{1}';
</script>
</body>
</html>
